<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Arcane Divination ¬∑ Tarot Reading (Fixed)</title>
  <meta name="theme-color" content="#0f0f13" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=Cinzel:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #0a0612;
      --panel: #120a1f;
      --muted: #9b8fb8;
      --text: #e8e4f0;
      --brand: #d946ef;
      --brand-2: #f59e0b;
      --accent: #10b981;
      --shadow: 0 10px 40px rgba(217,70,239,.25);
      --glass: rgba(139,92,246,.08);
      --glass-brd: rgba(139,92,246,.25);
      --fool-glow-1: rgba(239,68,68,.22);
      --fool-glow-2: rgba(217,70,239,.30);
    }

    *{box-sizing:border-box; margin:0; padding:0}
    html,body{height:100%}
    body{
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background:
        radial-gradient(ellipse 1400px 900px at 90% -15%, rgba(217,70,239,.12), transparent 55%),
        radial-gradient(ellipse 1000px 700px at 10% 100%, rgba(245,158,11,.10), transparent 50%),
        var(--bg);
      color:var(--text); line-height:1.6; letter-spacing:.2px;
      background-attachment: fixed; padding:20px;
    }

    .container{max-width:980px; margin:0 auto}
    .header{text-align:center; padding:36px 20px 12px}
    .header h1{
      font-family:'Cinzel', serif; font-size:clamp(30px, 5vw, 48px);
      background:linear-gradient(120deg, var(--brand), var(--brand-2), var(--accent));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      margin-bottom:8px; font-weight:900;
    }
    .header p{color:var(--muted); font-size:15px}

    .controls{display:flex; gap:12px; align-items:center; justify-content:center; flex-wrap:wrap; margin-top:12px}
    .back-btn{
      display:inline-flex; align-items:center; gap:8px; padding:8px 12px;
      background:var(--glass); border:1px solid var(--glass-brd); border-radius:10px;
      color:var(--text); text-decoration:none; transition:all .2s ease; font-weight:500;
    }
    .toggle{
      display:inline-flex; gap:8px; align-items:center; padding:8px 12px;
      background:var(--panel); border-radius:12px; border:1px solid rgba(255,255,255,.04);
      color:var(--text);
    }

    .reading-selector{
      display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));
      gap:12px; margin:28px 0;
    }
    .spread-card{
      background:linear-gradient(135deg, rgba(139,92,246,.06), rgba(245,158,11,.05));
      border:1px solid var(--glass-brd); border-radius:16px; padding:18px;
      cursor:pointer; transition:all .25s ease; text-align:center;
    }
    .spread-card:hover{transform:translateY(-4px); border-color:var(--brand); box-shadow:var(--shadow)}
    .spread-card.active{border-color:var(--brand); box-shadow:0 20px 60px rgba(217,70,239,.18)}
    .spread-icon{font-size:40px; margin-bottom:10px}
    .spread-title{font-family:'Cinzel', serif; font-size:18px; font-weight:700; margin-bottom:4px}
    .spread-desc{font-size:13px; color:var(--muted)}

    .btn{
      display:inline-flex; align-items:center; gap:10px; padding:14px 26px;
      background:linear-gradient(135deg, var(--brand), var(--brand-2));
      border:none; border-radius:12px; color:#fff; font-size:15px;
      font-weight:700; cursor:pointer; transition:all .25s ease;
      box-shadow:var(--shadow);
    }
    .controls-right{display:flex; gap:12px; align-items:center; margin-left:auto}

    .cards-container{
      display:flex; justify-content:center; gap:18px; flex-wrap:wrap;
      margin:34px 0; min-height:360px; align-items:center;
      perspective:1400px;
    }

    .tarot-card{
      width:170px; height:270px; perspective:1000px; cursor:pointer;
      transform-style:preserve-3d; transition:transform .18s ease;
      position:relative;
    }

    .card-inner{
      width:100%; height:100%; position:relative; transition:transform .9s;
      transform-style:preserve-3d;
    }
    /* flip state */
    .tarot-card.flipped .card-inner{ transform: rotateY(180deg); }

    .card-face{
      position:absolute; width:100%; height:100%; backface-visibility:hidden;
      -webkit-backface-visibility:hidden;
      border-radius:14px; display:flex; flex-direction:column; align-items:center;
      justify-content:center; padding:18px; border:2px solid var(--glass-brd);
      box-shadow:var(--shadow); overflow:hidden; background:linear-gradient(135deg,var(--panel), rgba(0,0,0,.15));
      transition:box-shadow .3s, transform .3s, z-index .05s;
    }

    .card-back{
      background:linear-gradient(135deg, rgba(139,92,246,.18), rgba(245,158,11,.12));
      display:flex; align-items:center; justify-content:center; font-size:72px; opacity:.95;
      transform: rotateY(0deg);
      z-index:2;
    }
    .card-front{
      transform: rotateY(180deg);
      text-align:center; color:var(--text);
      z-index:1;
    }

    /* ensure front is above back when flipped */
    .tarot-card.flipped .card-front{ z-index:3 }
    .tarot-card.flipped .card-back{ z-index:1 }

    .card-emoji{font-size:56px; margin-bottom:12px}
    .card-name{
      font-family:'Cinzel', serif; font-size:15px; font-weight:800;
      margin-bottom:8px; color:var(--brand-2);
    }
    .card-meaning{font-size:12px; color:var(--muted); line-height:1.4; min-height:40px}

    /* reversed presentation ‚Äî do not override inner transform; rotate the front face visually */
    .tarot-card.reversed .card-front{
      /* keep the base rotateY(180deg) and add a visual flip so the front shows upside-down */
      transform: rotateY(180deg) rotate(180deg);
    }
    .tarot-card.reversed .card-emoji{ transform: rotate(180deg); }

    /* fool glow */
    .fool-glow{
      box-shadow: 0 0 14px 3px var(--fool-glow-2), 0 0 36px 8px var(--fool-glow-1) inset;
      border-color: rgba(255,255,255,.12);
      animation: foolPulse 2.6s infinite;
    }
    @keyframes foolPulse{
      0%{transform: translateY(0) scale(1)}
      50%{transform: translateY(-4px) scale(1.01)}
      100%{transform: translateY(0) scale(1)}
    }

    .interpretation{
      background:linear-gradient(135deg, rgba(139,92,246,.10), rgba(245,158,11,.08));
      border:1px solid var(--glass-brd); border-radius:14px; padding:22px;
      margin:24px 0; backdrop-filter:blur(6px); box-shadow:var(--shadow);
      opacity:0; transform:translateY(14px); transition:all .5s ease;
    }
    .interpretation.show{opacity:1; transform:translateY(0)}
    .card-detail{
      margin:14px 0; padding:14px; background:rgba(0,0,0,.12);
      border-radius:10px; border-left:4px solid var(--brand);
    }
    .card-detail h3{ font-family:'Cinzel', serif; font-size:16px; color:var(--brand); margin-bottom:8px; }

    .fool-banner{
      text-align:center; font-family:'Cinzel', serif; font-weight:900; margin:16px 0;
      color:transparent; -webkit-background-clip:text; background-clip:text;
      background:linear-gradient(90deg,#ef4444,#d946ef,#f59e0b); font-size:30px;
      animation:shimmer 2.5s linear infinite;
    }
    @keyframes shimmer{0%{filter:hue-rotate(0)}100%{filter:hue-rotate(360deg)}}

    .confetti-piece{
      width:8px;height:12px;border-radius:2px;position:fixed;top:-20px;
      opacity:0.95; transform:translateY(0);
      animation:confettiFall linear forwards;
      z-index:9999;
    }
    @keyframes confettiFall{
      to{transform:translateY(120vh) rotate(720deg); opacity:0.95}
    }

    @media (max-width:640px){
      .tarot-card{width:150px;height:240px}
      .spread-icon{font-size:32px}
    }
  </style>
</head>
<body id="pageBody">
  <div class="container">
    <a href="index.html" class="back-btn">‚Üê Return to Grimoire</a>

    <div class="header">
      <h1>üîÆ Arcane Divination</h1>
      <p>Draw from the Major and Minor Arcana. Enable reversals to unlock shadow meanings.</p>
    </div>

    <div class="controls" role="region" aria-label="reading controls">
      <div class="reading-selector" style="flex:1">
        <div class="spread-card active" data-spread="single" role="button" tabindex="0">
          <div class="spread-icon">üÉè</div>
          <div class="spread-title">Single Card</div>
          <div class="spread-desc">Quick insight into your question</div>
        </div>
        <div class="spread-card" data-spread="three" role="button" tabindex="0">
          <div class="spread-icon">üé¥</div>
          <div class="spread-title">Three Card</div>
          <div class="spread-desc">Past ¬∑ Present ¬∑ Future</div>
        </div>
        <div class="spread-card" data-spread="celtic" role="button" tabindex="0">
          <div class="spread-icon">‚ú®</div>
          <div class="spread-title">Celtic Cross</div>
          <div class="spread-desc">Deep, layered reading (simplified)</div>
        </div>
        <div class="spread-card" data-spread="full" role="button" tabindex="0">
          <div class="spread-icon">üîÆ</div>
          <div class="spread-title">Full Reading</div>
          <div class="spread-desc">Majors + Minors + optional reversals</div>
        </div>
      </div>

      <div class="controls-right">
        <label class="toggle" title="Include Minor Arcana">
          <input id="includeMinors" type="checkbox" aria-label="Include Minor Arcana" /> Include Minors
        </label>
        <label class="toggle" title="Allow reversed card meanings">
          <input id="allowReversals" type="checkbox" aria-label="Allow Reversals" /> Allow Reversals
        </label>
        <button class="btn" id="drawBtn">‚ú® Divine Your Fate ‚ú®</button>
      </div>
    </div>

    <div class="cards-container" id="cardsContainer" aria-live="polite"></div>
    <div class="interpretation" id="interpretation" aria-live="polite"></div>
  </div>

  <script>
    // Major Arcana (same as before)
    const majorArcana = [
      {slug:'fool', name:'The Fool', emoji:'üÉè', detailed: "Beginnings, leaps of faith, innocence in the face of the unknown. The Fool asks you to step with curiosity rather than fear ‚Äî a threshold between what was and what may be."},
      {slug:'magician', name:'The Magician', emoji:'üé©', detailed: "Manifestation through focused will. You possess the tools to create change; intention and action align to transform ideas into reality."},
      {slug:'high-priestess', name:'The High Priestess', emoji:'üåô', detailed: "Hidden knowledge, intuition, and inner voice. The High Priestess invites silence ‚Äî answers emerge from reflection and dreams rather than outward noise."},
      {slug:'empress', name:'The Empress', emoji:'üëë', detailed: "Fertility, abundance, and creative nurture. A time to cultivate, care, and let projects or relationships ripen into form through tenderness."},
      {slug:'emperor', name:'The Emperor', emoji:'‚öîÔ∏è', detailed: "Structure, boundaries, and leadership. The Emperor recommends discipline and the wise application of power to bring order and safety."},
      {slug:'hierophant', name:'The Hierophant', emoji:'üìø', detailed: "Tradition, mentorship and communal wisdom. Seek counsel or anchor yourself in values that have stood the test of time."},
      {slug:'lovers', name:'The Lovers', emoji:'üíï', detailed: "Relationship, alignment of values, and soulful choices. This card asks you to choose with authenticity and to honor the bonds that reflect your truth."},
      {slug:'chariot', name:'The Chariot', emoji:'üèá', detailed: "Triumph by focused determination. Harness conflicting forces through discipline and confidence; momentum and conquest are possible when you steer clearly."},
      {slug:'strength', name:'Strength', emoji:'ü¶Å', detailed: "Gentle courage, resilience, and compassionate power. True influence comes from patience and quiet resolve rather than force."},
      {slug:'hermit', name:'The Hermit', emoji:'üïØÔ∏è', detailed: "Solitude for inner search. Pull back to illuminate your path; wisdom emerges from focused introspection and honest solitude."},
      {slug:'wheel', name:'Wheel of Fortune', emoji:'üé°', detailed: "Cycles and turning points beyond your control. Accept change as a teacher ‚Äî fortunes shift and new chapters begin."},
      {slug:'justice', name:'Justice', emoji:'‚öñÔ∏è', detailed: "Karma, truth, and balanced accountability. Clear, righteous choices restore balance; consequence and fairness shape outcomes."},
      {slug:'hanged-man', name:'The Hanged Man', emoji:'üôÉ', detailed: "Surrender and perspective-shift. Release attachment to old positions; suspension can reveal unexpected insight and spiritual growth."},
      {slug:'death', name:'Death', emoji:'üíÄ', detailed: "Transformation, endings that birth renewal. Letting go clears the way for authentic reinvention rather than literal destruction."},
      {slug:'temperance', name:'Temperance', emoji:'‚öóÔ∏è', detailed: "Integration and moderation. Synthesis of opposites yields harmony ‚Äî patience and balanced blending heal extremes."},
      {slug:'devil', name:'The Devil', emoji:'üòà', detailed: "Bindings, temptation, and shadow patterns. Name the chains and reclaim agency; liberation begins with honest admission."},
      {slug:'tower', name:'The Tower', emoji:'üè∞', detailed: "Sudden upheaval and revelation. Structures built on illusion crumble; catastrophe opens space for genuine rebuilding."},
      {slug:'star', name:'The Star', emoji:'‚≠ê', detailed: "Hope, healing, and renewed faith. Quiet blessings soothe the spirit and guide toward meaning and restoration."},
      {slug:'moon', name:'The Moon', emoji:'üåï', detailed: "Illusion, dreams, and the deep subconscious. Navigate uncertainties carefully ‚Äî intuition and introspection reveal shadowed truths."},
      {slug:'sun', name:'The Sun', emoji:'‚òÄÔ∏è', detailed: "Joy, clarity, and vitality. Success and warmth shine; this is a time of celebration and life-affirming energy."},
      {slug:'judgement', name:'Judgement', emoji:'üé∫', detailed: "Awakening and reckoning. A call to self-evaluate and answer your deeper vocation; rebirth follows honest appraisal."},
      {slug:'world', name:'The World', emoji:'üåç', detailed: "Completion, synthesis, and travel into new cycles. Celebrate endings as accomplishments; prepare for broader horizons."}
    ];

    // Minor arcana (kept as the expanded list you requested)
    const minorArcana = [
      // WANDS
      {slug:'ace-wands', name:'Ace of Wands', suit:'Wands', rank:'Ace', element:'Fire', emoji:'üî•', detailed: "A bright spark of creative impulse or the first push toward a new endeavor. The Ace of Wands heralds potential ‚Äî a call to act with courage and curiosity."},
      {slug:'two-wands', name:'Two of Wands', suit:'Wands', rank:'Two', element:'Fire', emoji:'üî•', detailed: "Vision and planning; weighing the horizon and making the first strategic choices for expansion."},
      {slug:'three-wands', name:'Three of Wands', suit:'Wands', rank:'Three', element:'Fire', emoji:'üî•', detailed: "Initial expansion and the early returns to patient effort. Partnerships and trade begin to show fruit."},
      {slug:'four-wands', name:'Four of Wands', suit:'Wands', rank:'Four', element:'Fire', emoji:'üî•', detailed: "Celebration, safe harbors, and community milestones ‚Äî a welcome pause to enjoy accomplishments."},
      {slug:'five-wands', name:'Five of Wands', suit:'Wands', rank:'Five', element:'Fire', emoji:'üî•', detailed: "Friction and contest that test resolve. These trials sharpen skills and clarify priorities."},
      {slug:'six-wands', name:'Six of Wands', suit:'Wands', rank:'Six', element:'Fire', emoji:'üî•', detailed: "Recognition and public success; accept praise with grounded humility and lead responsibly."},
      {slug:'seven-wands', name:'Seven of Wands', suit:'Wands', rank:'Seven', element:'Fire', emoji:'üî•', detailed: "Standing firm against opposition ‚Äî defend your gains with clarity and confidence."},
      {slug:'eight-wands', name:'Eight of Wands', suit:'Wands', rank:'Eight', element:'Fire', emoji:'üî•', detailed: "Swift progress and communications; events accelerate and require rapid, decisive action."},
      {slug:'nine-wands', name:'Nine of Wands', suit:'Wands', rank:'Nine', element:'Fire', emoji:'üî•', detailed: "Endurance after repeated strain. You are battle-worn but resolute ‚Äî protect your last reserves."},
      {slug:'ten-wands', name:'Ten of Wands', suit:'Wands', rank:'Ten', element:'Fire', emoji:'üî•', detailed: "Overload and heavy responsibility. Release, delegate, or reprioritize before the load breaks you."},
      {slug:'page-wands', name:'Page of Wands', suit:'Wands', rank:'Page', element:'Fire', emoji:'üî•', detailed: "A fresh messenger of creative curiosity ‚Äî test ideas through playful experiments."},
      {slug:'knight-wands', name:'Knight of Wands', suit:'Wands', rank:'Knight', element:'Fire', emoji:'üî•', detailed: "Bold pursuit and adventure; temper impulsiveness with a sense of consequence."},
      {slug:'queen-wands', name:'Queen of Wands', suit:'Wands', rank:'Queen', element:'Fire', emoji:'üî•', detailed: "Warm charisma and creative leadership; inspire others while tending your craft."},
      {slug:'king-wands', name:'King of Wands', suit:'Wands', rank:'King', element:'Fire', emoji:'üî•', detailed: "Visionary authority and entrepreneurial drive; lead with clear courage and long-term aim."},

      // CUPS
      {slug:'ace-cups', name:'Ace of Cups', suit:'Cups', rank:'Ace', element:'Water', emoji:'ü•õ', detailed: "New emotional openings: love, compassion, or spiritual renewal arriving like a spring."},
      {slug:'two-cups', name:'Two of Cups', suit:'Cups', rank:'Two', element:'Water', emoji:'ü•õ', detailed: "Mutual attraction, partnership, and healing bonds ‚Äî a meeting of equals in feeling."},
      {slug:'three-cups', name:'Three of Cups', suit:'Cups', rank:'Three', element:'Water', emoji:'ü•õ', detailed: "Celebration, community support, and shared joy; friendships nourish the soul."},
      {slug:'four-cups', name:'Four of Cups', suit:'Cups', rank:'Four', element:'Water', emoji:'ü•õ', detailed: "Boredom or missed opportunity due to inward focus ‚Äî reassess offers with fresh eyes."},
      {slug:'five-cups', name:'Five of Cups', suit:'Cups', rank:'Five', element:'Water', emoji:'ü•õ', detailed: "Sorrow and regret; honour loss but notice what remains to rebuild."},
      {slug:'six-cups', name:'Six of Cups', suit:'Cups', rank:'Six', element:'Water', emoji:'ü•õ', detailed: "Nostalgic warmth and simple kindness; healing through memory and gentle reconnection."},
      {slug:'seven-cups', name:'Seven of Cups', suit:'Cups', rank:'Seven', element:'Water', emoji:'ü•õ', detailed: "Many choices, some illusory; cultivate focus to turn desire into meaningful pursuit."},
      {slug:'eight-cups', name:'Eight of Cups', suit:'Cups', rank:'Eight', element:'Water', emoji:'ü•õ', detailed: "A necessary leaving ‚Äî walking toward deeper authenticity despite discomfort."},
      {slug:'nine-cups', name:'Nine of Cups', suit:'Cups', rank:'Nine', element:'Water', emoji:'ü•õ', detailed: "Comfort, contentment, and a savoring of small satisfactions."},
      {slug:'ten-cups', name:'Ten of Cups', suit:'Cups', rank:'Ten', element:'Water', emoji:'ü•õ', detailed: "Emotional fulfillment and family harmony; a peaceful, blessed container."},
      {slug:'page-cups', name:'Page of Cups', suit:'Cups', rank:'Page', element:'Water', emoji:'ü•õ', detailed: "A tender message, new sensitivity, or the stirring of imaginative gifts."},
      {slug:'knight-cups', name:'Knight of Cups', suit:'Cups', rank:'Knight', element:'Water', emoji:'ü•õ', detailed: "A romantic or idealistic pursuit; move with heart but stay grounded."},
      {slug:'queen-cups', name:'Queen of Cups', suit:'Cups', rank:'Queen', element:'Water', emoji:'ü•õ', detailed: "Deep empathy and intuitive care ‚Äî an emotional steward who knows boundaries."},
      {slug:'king-cups', name:'King of Cups', suit:'Cups', rank:'King', element:'Water', emoji:'ü•õ', detailed: "Emotional maturity and steadiness ‚Äî counsel that soothes conflict and steadies others."},

      // SWORDS
      {slug:'ace-swords', name:'Ace of Swords', suit:'Swords', rank:'Ace', element:'Air', emoji:'‚öîÔ∏è', detailed: "A moment of truth or decisive clarity; use the blade of reason with moral purpose."},
      {slug:'two-swords', name:'Two of Swords', suit:'Swords', rank:'Two', element:'Air', emoji:'‚öîÔ∏è', detailed: "A stalemate or guarded choice; bring facts and gentle courage to the table."},
      {slug:'three-swords', name:'Three of Swords', suit:'Swords', rank:'Three', element:'Air', emoji:'‚öîÔ∏è', detailed: "Heartache and honest pain; grieving clears illusions and makes space for truth."},
      {slug:'four-swords', name:'Four of Swords', suit:'Swords', rank:'Four', element:'Air', emoji:'‚öîÔ∏è', detailed: "Rest and mental recuperation ‚Äî strategic withdrawal to gain endurance."},
      {slug:'five-swords', name:'Five of Swords', suit:'Swords', rank:'Five', element:'Air', emoji:'‚öîÔ∏è', detailed: "Pyrrhic wins and moral cost; consider the long-term damage of short victories."},
      {slug:'six-swords', name:'Six of Swords', suit:'Swords', rank:'Six', element:'Air', emoji:'‚öîÔ∏è', detailed: "Transition toward calmer waters; travel or thought-shift fosters healing."},
      {slug:'seven-swords', name:'Seven of Swords', suit:'Swords', rank:'Seven', element:'Air', emoji:'‚öîÔ∏è', detailed: "Subterfuge or cunning strategy; mind integrity and reclaim honest methods."},
      {slug:'eight-swords', name:'Eight of Swords', suit:'Swords', rank:'Eight', element:'Air', emoji:'‚öîÔ∏è', detailed: "Mental constraints ‚Äî the bindings are often removable through changed perspective."},
      {slug:'nine-swords', name:'Nine of Swords', suit:'Swords', rank:'Nine', element:'Air', emoji:'‚öîÔ∏è', detailed: "Anxiety that feeds on worst-case stories; name the fear to reduce its power."},
      {slug:'ten-swords', name:'Ten of Swords', suit:'Swords', rank:'Ten', element:'Air', emoji:'‚öîÔ∏è', detailed: "A painful ending that paradoxically clears the way for a new narrative."},
      {slug:'page-swords', name:'Page of Swords', suit:'Swords', rank:'Page', element:'Air', emoji:'‚öîÔ∏è', detailed: "Alert curiosity and sharp questions; be valiant in inquiry and careful with hasty judgment."},
      {slug:'knight-swords', name:'Knight of Swords', suit:'Swords', rank:'Knight', element:'Air', emoji:'‚öîÔ∏è', detailed: "Rapid thought and decisive moves; pace speed with precision to avoid collateral damage."},
      {slug:'queen-swords', name:'Queen of Swords', suit:'Swords', rank:'Queen', element:'Air', emoji:'‚öîÔ∏è', detailed: "Clear discernment and firm boundaries; compassion guided by truth."},
      {slug:'king-swords', name:'King of Swords', suit:'Swords', rank:'King', element:'Air', emoji:'‚öîÔ∏è', detailed: "Judicious strategy and authoritative clarity; lead with ethics and intellect."},

      // PENTACLES
      {slug:'ace-pentacles', name:'Ace of Pentacles', suit:'Pentacles', rank:'Ace', element:'Earth', emoji:'üèµÔ∏è', detailed: "Grounded opportunity and material seed ‚Äî pragmatic care yields lasting reward."},
      {slug:'two-pentacles', name:'Two of Pentacles', suit:'Pentacles', rank:'Two', element:'Earth', emoji:'üèµÔ∏è', detailed: "Juggling responsibilities with grace; flexibility keeps systems functional."},
      {slug:'three-pentacles', name:'Three of Pentacles', suit:'Pentacles', rank:'Three', element:'Earth', emoji:'üèµÔ∏è', detailed: "Skilled collaboration and visible craftsmanship; reputation grows through mastery."},
      {slug:'four-pentacles', name:'Four of Pentacles', suit:'Pentacles', rank:'Four', element:'Earth', emoji:'üèµÔ∏è', detailed: "Conservatism and clinging; secure what you must but avoid suffocating growth."},
      {slug:'five-pentacles', name:'Five of Pentacles', suit:'Pentacles', rank:'Five', element:'Earth', emoji:'üèµÔ∏è', detailed: "Material hardship that calls for community and practical support ‚Äî ask for help."},
      {slug:'six-pentacles', name:'Six of Pentacles', suit:'Pentacles', rank:'Six', element:'Earth', emoji:'üèµÔ∏è', detailed: "Generosity and equitable exchange; giving and receiving stabilize networks."},
      {slug:'seven-pentacles', name:'Seven of Pentacles', suit:'Pentacles', rank:'Seven', element:'Earth', emoji:'üèµÔ∏è', detailed: "Evaluation of long-term investment; patience and course-correction yield harvests."},
      {slug:'eight-pentacles', name:'Eight of Pentacles', suit:'Pentacles', rank:'Eight', element:'Earth', emoji:'üèµÔ∏è', detailed: "Dedicated craft and apprenticeship; steady repetition builds expertise."},
      {slug:'nine-pentacles', name:'Nine of Pentacles', suit:'Pentacles', rank:'Nine', element:'Earth', emoji:'üèµÔ∏è', detailed: "Comfort earned through discipline; enjoy the quiet fruits of industriousness."},
      {slug:'ten-pentacles', name:'Ten of Pentacles', suit:'Pentacles', rank:'Ten', element:'Earth', emoji:'üèµÔ∏è', detailed: "Legacy and generational stability; consider the long arc of your stewardship."},
      {slug:'page-pentacles', name:'Page of Pentacles', suit:'Pentacles', rank:'Page', element:'Earth', emoji:'üèµÔ∏è', detailed: "A practical proposition or new study; approach with curiosity and care."},
      {slug:'knight-pentacles', name:'Knight of Pentacles', suit:'Pentacles', rank:'Knight', element:'Earth', emoji:'üèµÔ∏è', detailed: "Dependable effort and methodical progress; reliable, if slow, triumph."},
      {slug:'queen-pentacles', name:'Queen of Pentacles', suit:'Pentacles', rank:'Queen', element:'Earth', emoji:'üèµÔ∏è', detailed: "Nurturing material care and sensible comfort; steward household and resources with warmth."},
      {slug:'king-pentacles', name:'King of Pentacles', suit:'Pentacles', rank:'King', element:'Earth', emoji:'üèµÔ∏è', detailed: "Practical authority and economic wisdom; steward assets with prudence and generosity."}
    ];

    // Utility shuffle
    function shuffle(arr){ const copy = arr.slice(); for(let i=copy.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [copy[i],copy[j]]=[copy[j],copy[i]] } return copy; }

    // State
    let currentSpread = 'single';
    let readingCount = 0;

    // Spread selector handlers
    document.querySelectorAll('.spread-card').forEach(card => {
      card.addEventListener('click', () => {
        document.querySelectorAll('.spread-card').forEach(c => c.classList.remove('active'));
        card.classList.add('active');
        currentSpread = card.dataset.spread;
        clearOutput();
      });
      card.addEventListener('keydown', (e) => { if(e.key==='Enter' || e.key===' ') card.click(); });
    });

    function clearOutput(){
      document.getElementById('cardsContainer').innerHTML = '';
      const interpretation = document.getElementById('interpretation');
      interpretation.innerHTML = '';
      interpretation.classList.remove('show');
      document.getElementById('pageBody').classList.remove('fool-mode-body');
    }

    // Draw button
    document.getElementById('drawBtn').addEventListener('click', () => {
      readingCount++;
      clearOutput();

      const shouldActivateFool = readingCount % (3 + Math.floor(Math.random()*3)) === 0;
      const includeMinors = document.getElementById('includeMinors').checked;
      const allowReversals = document.getElementById('allowReversals').checked;

      // Determine spread size & positions
      let numCards; let positions;
      if(currentSpread === 'single'){ numCards = 1; positions = ['Answer']; }
      else if(currentSpread === 'three'){ numCards = 3; positions = ['Past','Present','Future']; }
      else if(currentSpread === 'celtic'){ numCards = 5; positions = ['Present','Challenge','Past','Future','Outcome']; }
      else { numCards = 7; positions = ['Anchor','Obstacle','Heart','Mind','Near Future','Advice','Outcome']; }

      // pool = majors + optional minors
      let pool = majorArcana.map(m => ({...m, arcana:'major'}));
      if(includeMinors || currentSpread === 'full'){
        pool = pool.concat(minorArcana.map(m => ({...m, arcana:'minor'})));
      }

      const selection = [];

      if(shouldActivateFool){
        // BUG FIX: guarantee every card is The Fool by creating explicit copies for each slot.
        const foolTemplate = {...majorArcana.find(m => m.slug === 'fool'), arcana:'major', foolBless:true};
        for(let i=0;i<numCards;i++){
          const c = {...foolTemplate};
          c.position = positions[i] || `Position ${i+1}`;
          // small chance of reversed appearance if reversals allowed (visual only)
          c.reversed = allowReversals ? (Math.random() < 0.25) : false;
          selection.push(c);
        }
      } else {
        // Normal draw: shuffle pool and take numCards unique cards
        const shuffled = shuffle(pool);
        for(let i=0;i<numCards;i++){
          const cand = {...shuffled[i % shuffled.length]};
          cand.reversed = allowReversals ? (Math.random() < 0.45) : false;
          cand.position = positions[i] || `Position ${i+1}`;

          // if a minor, ensure we pull the detailed text from the minorArcana master list
          if(cand.arcana === 'minor'){
            const found = minorArcana.find(m => m.slug === cand.slug || m.name === cand.name);
            cand.detailed = found ? found.detailed : cand.detailed || `${cand.name} ‚Äî ${cand.element} energy.`;
          }

          selection.push(cand);
        }
      }

      // Render and interpret
      renderCards(selection, shouldActivateFool);
      setTimeout(()=> showInterpretation(selection, shouldActivateFool), numCards * 320 + 600);
    });

    // Render cards
    function renderCards(selection, isFool){
      const container = document.getElementById('cardsContainer');
      container.innerHTML = '';

      if(isFool){
        document.getElementById('pageBody').classList.add('fool-mode-body');
        triggerConfetti(24);
      } else {
        document.getElementById('pageBody').classList.remove('fool-mode-body');
      }

      selection.forEach((card, idx) => {
        const cardEl = document.createElement('div');
        cardEl.className = 'tarot-card';
        if(card.reversed) cardEl.classList.add('reversed');

        // ensure fool-marked cards have fool-glow class and show Fool name & emoji
        // (this ensures all cards visually become The Fool when blessed)
        if(card.foolBless){
          card.name = 'The Fool';
          card.emoji = 'üÉè';
        }

        const frontClass = card.foolBless ? 'fool-glow' : '';
        const meaningSnippet = (card.arcana === 'major' ? (card.detailed ? card.detailed.split('.')[0] : '') : (card.detailed || '') );

        cardEl.innerHTML = `
          <div class="card-inner">
            <div class="card-face card-back" aria-hidden="true">üîÆ</div>
            <div class="card-face card-front ${frontClass}">
              <div class="card-emoji">${card.emoji || 'üîÆ'}</div>
              <div class="card-name">${card.name}</div>
              <div class="card-meaning">${meaningSnippet}</div>
            </div>
          </div>
        `;

        // tilt interaction (cosmetic)
        cardEl.addEventListener('mousemove', (e)=>{
          const rect = cardEl.getBoundingClientRect();
          const x = (e.clientX - rect.left) / rect.width - 0.5;
          const y = (e.clientY - rect.top) / rect.height - 0.5;
          cardEl.style.transform = `rotateX(${(-y*6)}deg) rotateY(${(x*8)}deg)`;
        });
        cardEl.addEventListener('mouseleave', ()=>cardEl.style.transform = '');

        // append and flip staggered
        setTimeout(()=> {
          container.appendChild(cardEl);
          // small delay so append renders before flipping (prevents visual glitch)
          setTimeout(()=> cardEl.classList.add('flipped'), 120);
        }, idx * 260);
      });
    }

    // Show interpretation
    function showInterpretation(selection, isFool){
      const interpretation = document.getElementById('interpretation');
      interpretation.innerHTML = '';
      interpretation.classList.remove('show');

      if(isFool){
        // Grand Praise text ‚Äî entire reading replaced
        const header = `<div class="fool-banner">üÉè PRAISE THE FOOL ‚Äî THE GREAT JESTER OF THE THRESHOLD üÉè</div>`;
        const longPraise = `
          <p style="text-align:left; color:var(--muted); margin-bottom:12px; line-height:1.7;">
            All revealed cards are The Fool. This is no minor prank ‚Äî it is a cosmic cascade that folds the page of meaning
            into a single, dazzling jest. The Fool strips away the scaffolding of certainty and invites you to see through
            the lattice of expectation. In this unprecedented alignment, predictability dissolves and miraculous misalignment
            becomes a teacher. Expect coincidences that feel like riddles, doors that open with laughter, and the strange clarity
            of insight that arrives through paradox.
          </p>

          <p style="text-align:left; color:var(--muted); margin-bottom:12px; line-height:1.7;">
            Practically: lean into a curious, experimental step. The Fool's blessing rewards bold, compassionate absurdity.
            Try something small you feared looked foolish ‚Äî the fallout may be a new pathway or a liberating perspective.
            Spiritually: this is an initiation of light misrule; humility and humor together uncover a new kind of seeing.
          </p>

          <div class="card-detail">
            <h3>üÉè The Fool's Mandate</h3>
            <p>Surrender a little control. Offer a joke to the void. Step forward as if you were beginning for the first time.
            In honoring The Fool you accept that wisdom sometimes arrives wrapped as a prank. Praise the Fool and move.</p>
          </div>

          <p style="text-align:center; color:var(--muted); font-size:13px; margin-top:8px;">
            This grand reading dissolves normal interpretation ‚Äî hold curiosity, not answers.
          </p>
        `;
        interpretation.innerHTML = header + longPraise;
      } else {
        let html = '<h2>‚ú® Your Reading</h2>';
        selection.forEach(card => {
          const title = `${card.emoji || ''} ${card.position}: ${card.name}${card.reversed ? ' (Reversed)' : ''}`;
          const detail = card.arcana === 'major' ? (card.detailed || '') : (card.detailed || '');
          const reversedNote = card.reversed ? '<em style="color:var(--muted); display:block; margin-top:6px;">(Reversed: an internal block, delay, or shadow expression ‚Äî reflect on what resists you.)</em>' : '';
          html += `
            <div class="card-detail">
              <h3>${title}</h3>
              <p>${detail}</p>
              ${reversedNote}
            </div>
          `;
        });
        interpretation.innerHTML = html;
      }

      interpretation.classList.add('show');
    }

    // Confetti helper
    function triggerConfetti(count=12){
      const colors = ['#ef4444','#d946ef','#f59e0b','#10b981','#60a5fa','#fde68a'];
      for(let i=0;i<count;i++){
        const el = document.createElement('div');
        el.className = 'confetti-piece';
        el.style.left = Math.random() * 100 + 'vw';
        el.style.background = colors[Math.floor(Math.random()*colors.length)];
        el.style.transform = `rotate(${Math.random()*360}deg)`;
        const duration = 2500 + Math.random()*2500;
        el.style.animationDuration = duration + 'ms';
        el.style.animationDelay = (Math.random()*300) + 'ms';
        document.body.appendChild(el);
        setTimeout(()=> el.remove(), duration + 800);
      }
    }
  </script>
</body>
</html>
